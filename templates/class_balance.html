<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Class Balance</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="{{ url_for('static', filename='css/class_balance.css') }}" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

  <!-- NAVBAR + OFFCANVAS (copied from data_overview) -->
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <span class="navbar-brand logo">SimpliML</span>
      <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
  </nav>
  <div class="offcanvas offcanvas-end" tabindex="-1" id="sidebar">
    <div class="offcanvas-header">
      <h5 id="sidebarLabel" class="offcanvas-title">Menu</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="list-unstyled">
        <li><a href="/">Home</a></li>
        <li><a href="/upload">Upload</a></li>
        <li><a href="/preprocess_page">Preprocess</a></li>
        <li><a href="/select_features">Feature Selection</a></li>
        <li><a href="/select_features">Train/Test Split</a></li>

      </ul>
    </div>
  </div>

  <div class="container py-4">
    <h1 class="text-center mb-3">Class Balance</h1>
    <p class="explanation text-center">
      When one class in your target (e.g. 95% “no” vs. 5% “yes”) dominates, models tend to predict the majority by default and miss the rare cases.
      Rebalancing gives each class roughly equal weight, helping your model learn the “rare” class better for fairer, more accurate predictions.This step is applied only to the training split; the test split remains unchanged so evaluation stays unbiased.
    </p>

    <div class="row gx-4">
      <!-- LEFT PANEL -->
      <div class="col-md-6">
        <div class="box3d p-4 d-flex flex-column align-items-center">
          <h4  class="box-title text-center w-100"> Rebalance the class</h4>
         <div class="balance-options">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="method" id="optUnder" value="under">
            <label class="form-check-label" for="optUnder" data-bs-toggle="tooltip" title="Randomly remove samples from the majority class">
              Under-sampling
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="method" id="optOver" value="over">
            <label class="form-check-label" for="optOver" data-bs-toggle="tooltip" title="SMOTE: synthesize new minority samples">
              Over-sampling (SMOTE)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="method" id="optBoth" value="both">
            <label class="form-check-label" for="optBoth" data-bs-toggle="tooltip" title="Under-sample then SMOTE">
              Both under & over sampling
            </label>
          </div>
         </div> 

          <div id="bothControls" class="mt-3 w-75" style="display:none;">
            <label for="percentInput" class="form-label">Reduce majority by</label>
            <div class="input-group input-group-sm mb-3">
              <input type="number" id="percentInput" class="form-control" min="10" max="90" value="50">
              <span class="input-group-text">%</span>
            </div>
          </div>

          <button id="btnRebalance" class="btn btn-primary">Rebalance</button>
          <!-- Loading text -->
          <div id="loading-indicator" style="display:none; margin-top:15px; color:#555; font-size:0.95rem;">
            Balancing data, please wait...
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL -->
      <div class="col-md-6">
        <div class="box3d p-4 text-center">
          <h4>Class Balance of Target</h4>
          <!-- seed initial counts on data-attribute -->
          <canvas id="balanceChart" data-counts='{{ counts|tojson }}' height="200"></canvas>
        </div>
      </div>
    </div>
     
    <!-- Cross‐Validation Section -->
    <div class="divider my-5"></div>

    <div id="cvSection" class="text-center mb-5">
      <h1 class="mb-3">Cross Validation</h1>
      <p class="cv-explanation mb-4">
        k-fold cross-validation divides your
        data into <strong>k</strong> subsets. Each subset is held out in turn for
        validation, giving a more robust estimate of model performance. Cross-validation runs only on the training split; the test split is kept untouched for the final evaluation.
        Select the number of folds from the dropdown below
      </p>
      <div class="w-25 mx-auto mb-4">
        <select id="cvFolds" class="form-select form-select-lg">
          <option value="3">3 folds</option>
          <option value="5">5 folds</option>
          <option value="10" selected>10 folds</option>
        </select>
      </div>
     <div>
     <div class="d-flex justify-content-end mt-4 mb-5">
 <div class="d-flex justify-content-end mt-4 mb-5">
  <button id="btnNext" class="btn btn-primary btn-lg"
        data-next-url="{{ url_for('model_selection') }}">
  Next
</button>

</div> 
</div>
</div>




  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/class_balance.js') }}"></script>
</body>
</html>
