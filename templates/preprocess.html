<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Data Preprocessing</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <!-- Chart.js -->
  <script
    src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"
    defer
  ></script>

  <link
    href="{{ url_for('static', filename='css/style.css') }}"
    rel="stylesheet"
  >
  <link
    href="{{ url_for('static', filename='css/preprocess.css') }}"
    rel="stylesheet"
  >
</head>
<body class="bg-white">

  <!-- HEADER -->
  <nav class="navbar navbar-dark" style="background-color:#1877F2;">
    <div class="container-fluid">
      <span class="navbar-brand logo">SimpliML</span>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#sidebar"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
  </nav>

  <!-- SIDEBAR -->
  <div
    class="offcanvas offcanvas-end"
    tabindex="-1"
    id="sidebar"
  >
    <div class="offcanvas-header">
      <h5 id="sidebarLabel">Menu</h5>
      <button
        type="button"
        class="btn-close text-reset"
        data-bs-dismiss="offcanvas"
      ></button>
    </div>
    <div class="offcanvas-body">
      <ul class="list-unstyled">
        <li><a href="/">Home</a></li>
        <li><a href="/upload">Upload</a></li>
      </ul>
    </div>
  </div>

  <div class="container py-5">
    <h2 class="text-center mb-4">Data Preprocessing</h2>

    <div class="row gx-4 mb-5">
      <!-- Left Box -->
      <div class="col-md-6 mb-4">
        <div class="box3d p-4 text-center">       
          <button id="btnCat" class="btn btn-primary mb-3 w-75">
            View Categorical Countplots
          </button>
          <!-- NEW: Box Plot button -->
          <button id="btnBox" class="btn btn-primary mb-3 w-75">
            View Box Plots
          </button>
          <button id="btnMiss" class="btn btn-primary w-75">
            View Missing Data Chart
          </button>
        </div>
      </div>
      <!-- Right Box: initially shows explanatory text -->
    <div class="col-md-6 mb-4">
      
      <div id="introText" class="p-4">
         <h5>Categorical Countplots</h5>
         <p>
          A bar chart showing the frequency of each category in a categorical feature, 
          making it easy to spot class imbalances or rare levels at a glance. 
          By visualizing how often each label occurs, you can decide whether to 
          resample, combine infrequent categories, or choose an appropriate encoding 
          strategy before modeling.
         </p>
         <h5> Box Plots</h5>
         <p>
         A box plot is a graphical representation that shows the distribution of numerical data by displaying the minimum, maximum, median, first quartile (25%), and third quartile (75%) values. It helps identify outliers, visualize the spread and symmetry of data, and determine if data transformations or outlier removal might improve model performance.
         </p>
         <h5>Missing Data Chart</h5>
         <p>
          A bar chart showing the count of missing entries in each column, 
          highlighting features with high proportions of gaps. It informs 
          strategies for imputation, removal, or further investigation of 
          data-collection issues.
         </p>
      </div>
        
    <!-- Steps Card -->
      <!-- B) Hidden chart container: 3D box, scrollable -->
      <div id="chartWrapper" class="box3d p-4" >
        <div id="plotBox"></div>
      </div>
    </div>
    <div class="box3d p-4 mb-3 mx-auto" style="max-width:600px;">
      <h5 class="text-center mb-3">Select preprocessing steps</h5>

      <form id="stepsForm" class="mb-3 text-start">
        <!-- Clean -->
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox"
                 id="stepClean" value="clean">
          <label class="form-check-label" for="stepClean"
                 data-tooltip="Removes extra spaces or symbols in column names so the system can read them correctly.">
            Clean column names
          </label>
        </div>

        <!-- Missing -->
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox"
                 id="stepMissing" value="missing">
          <label class="form-check-label" for="stepMissing"
                 data-tooltip="Removes rows with empty values so the model can use only complete data.">
            Handle missing values
          </label>
        </div>

        <!-- Duplicates -->
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox"
                 id="stepDup" value="duplicates">
          <label class="form-check-label" for="stepDup"
                 data-tooltip="Removes repeated rows, keeping the first one so the model doesn’t see the same case twice.">
            Remove duplicates
          </label>
        </div>

        <!-- Encode -->
        <div class="form-check mb-1">
          <input class="form-check-input" type="checkbox"
                 id="stepEncode" value="encode">
          <label class="form-check-label" for="stepEncode"
                 data-tooltip="Converts text categories (like “Male/Female”) into a format of numbers or binary columns so the model can understand them.">
            Encode categorical features
          </label>
        </div>
        <div class="radio-group hidden ps-4" id="encOptions">
          <div class="form-check">
            <input class="form-check-input" type="radio"
                   name="encode_method" value="onehot" id="encOneHot">
            <label class="form-check-label" for="encOneHot"
                   data-tooltip="Creates separate columns for each category; useful when categories don’t have a natural order.">
              One-Hot Encoding
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio"
                   name="encode_method" value="label" id="encLabel">
            <label class="form-check-label" for="encLabel"
                   data-tooltip="Assigns numbers to each category; best when categories have a natural order.">
              Label Encoding
            </label>
          </div>
        </div>

        <!-- Scale -->
        <div class="form-check mb-1">
          <input class="form-check-input" type="checkbox"
                 id="stepScale" value="scale">
          <label class="form-check-label" for="stepScale"
                 data-tooltip="Adjusts numbers to the same scale so no single measurement dominates the model.">
            Scale numeric features
          </label>
        </div>
        <div class="radio-group hidden ps-4" id="scaleOptions">
         <div class="form-check">
           <input class="form-check-input" type="radio"
           name="scale_method" value="standardize" id="scaleStd">
           <label class="form-check-label" for="scaleStd"
           data-tooltip="Centers data around zero with equal spread; works well for most models.(z-score)">
             Standardization
           </label>
         </div>
         <div class="form-check">
          <input class="form-check-input" type="radio"
           name="scale_method" value="normalize" id="scaleNorm">
          <label class="form-check-label" for="scaleNorm"
           data-tooltip="Rescales values between 0 and 1; helpful when features have very different ranges.(Min-Max scaling)">
            Normalization
          </label>
         </div>
        </div>

        <!-- Outliers -->
        <div class="form-check mb-1">
          <input class="form-check-input" type="checkbox"
                 id="stepOutliers" value="outliers">
          <label class="form-check-label" for="stepOutliers"
                 data-tooltip="Manages unusual values that can distort results.">
            Handle outliers
          </label>
        </div>
        <div class="radio-group hidden ps-4" id="outOptions">
          <div class="form-check">
            <input class="form-check-input" type="radio"
                   name="outlier_method" value="remove" id="outRemove">
            <label class="form-check-label" for="outRemove"
                   data-tooltip="Removes rows where values fall outside 1.5×IQR (Interquartile Range) — eg:if most patient ages are 40–60, a value like 150 would be removed.">
              Remove outliers (IQR drop)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio"
                   name="outlier_method" value="cap" id="outCap">
            <label class="form-check-label" for="outCap"
                   data-tooltip="Keeps all rows but limits extreme values to the highest/lowest allowed by 1.5×IQR — eg: blood pressure of 300 would be capped to the upper limit.">
              Cap outliers (Winsorize)
            </label>
          </div>
            <div class="form-check">
              <input class="form-check-input" type="radio"
                     name="outlier_method" value="robust" id="outRobust">
              <label class="form-check-label" for="outRobust"
                      data-tooltip="First rescales data in a way that ignores extreme values, then fills missing values by looking at the closest matching records — helpful when both outliers and missing data exist.">
                 RobustScaler + KNN Impute
              </label>
            </div>

        </div>
      </form>

      <div class="text-center">
        <button id="procBtn" class="btn btn-primary">Preprocess</button>
      </div>
      <p id="procMsg" class="mt-3 text-center text-success"></p>
    </div>
    
     <!--result and download-->
     <div id="resultBox" class="mt-4" style="display:none">
      <!-- summary of changes -->
      <div id="summaryLogs" class="mb-3"></div>
      <!-- preview table -->
      <div id="previewDiv" class="table-responsive"></div>
    </div>
      <!-- DOWNLOAD BUTTON -->
  <div class="text-center mt-3">
    <a id="downloadBtn"
       href="#"
       class="btn btn-download"
       download>
      Download cleaned CSV
    </a>
  </div>

    <div class="text-end">
      <button id="nextBtn" class="btn btn-primary" >Next →</button>
    </div>
  </div>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  ></script>
  <script src="{{ url_for('static', filename='js/preprocess.js') }}"></script>
</body>
</html>
